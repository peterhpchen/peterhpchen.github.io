---
layout: post
title:  "怎麼寫正規表達式(Regular Expressions)?"
date:   2018-01-19 00:18:06 +0800
categories: regular-expression
---

> 在寫程式時常常會需要比對字串，或是從字串中取得目標的結果，在還不知道有正規表達式前，我都是使用像是indexOf之類的字串方法來比對，而我知道了正規表達式後，被這神奇的語法驚呆了，只用了一個表達式就可以實現我寫了幾十行的程式碼，但是對於他那像是天書般的寫法給嚇跑了，現在剛好有時間可以好好研究，這篇用來記錄正規表達式的寫法。

本文使用JavaScript的分隔符: 斜線(`/`)來表示一段正規表達式，如果使用的語言跟JavaScript的分隔符不同，請自行轉換。

正規表達式由兩種不同的字元組成: **一般字元**及**特殊字元**。

## 一般字元

在正規表達式中任何非特殊字元的字元都是一般字元，表達的是**完全相符**的條件，例如`/abc/`就是要完全符合`abc`的字串才符合此表達式的條件。

## 特殊字元

使用正規表達式定義的特殊字元做**模糊搜尋**，例如`/ab*c/`會對應到以`a`為開頭，中間有**零到多個**`b`(因為`*`這個特殊字元的作用)，最後以`c`結尾的字串，像是`ac`或是`abbbbbc`都會符合。

這些特殊字元可以依照作用不同被分為下面幾類:

* 字元組(Character Sets)
* 字元族(Character Classes)
* 反斜線(backslash)
* 邊界(Boundaries)
* 多重選項(或)
* 群組及回溯參照(Grouping and back references)
* 數量(Quantifiers)
* 判斷(Assertions)

### 字元組

如果在同個位置上想要找的不只有一個字串，而是在多個字串中的其中一個就符合條件，這時使用字元組可以達到此需求。

例如`[xyz]`就是只要`x`、`y`、`z`就會符合目標。

#### `[xyz]`及`[x-z]`

取得**符合中括號中其中一個字元**的字元。

如果愈查找的是連續的字母或數字，可以用hypen(`-`)來設定，例如設定`[a-d]`的效果跟`[abcd]`是一樣的。

如果真的要搜尋hypen(`-`)可以將其放在最前(後)面就可以查找，例如`[abcd-]`和`[-abcd]` 就會符合`non-profit`中的hyphen(`-`)。

在中括號內跳脫字元及特殊字元可以不用用反斜線(\\)來變為一般字元，例如`.`在正規表達式中原本代表除了空白字元外的所有字元，但如果寫成`[.]`就只會符合`.`這個字元。

字元組的中括號內可以使用字元族(例如`\w`)來做表示，例如`/[a-z.]+/`會跟`/[\w.]+/`一樣符合`test.i.ng`全部的字串。

#### `[^xyz]`

取得**不符合中括號中的任何字元**，其他的特性跟`[xyz]`相同。

例如`[^abc]`跟`[^a-c]`相同，在`brisket`中因第一個`b`不符合條件所以會抓到`r`，而`chop`也是會抓到`h`。

### 字元族

字元族就是**預定義的字元組**，他會將常用的字元組簡化，讓表達式更加簡潔好記。

#### `.`

符合**任何除了換行字元外的字元**，跟`[^\n\r\u2028\u2029]`有相同效果。

例如: `/.n/`可以在`nay, an apple is on the tree`中符合`an`，`on`，但是不能符合`nay`。

如果放在`[]`中的話會變成一般字元。

由於`.`不包含換行字元，如果要包含換行字元可以用`[^]`來比對。

#### `\d`

符合**任何數字字元**的條件，跟`[0-9]`效果相同。

例如在`B2 is the suite number.`中用`/\d/`或`/[0-9]/`會找到`2`。

#### `\D`

符合**任何非數字字元**的條件，跟`[^0-9]`效果相同。

例如在`B2 is the suite number.`中用`/\D/`或`/[^0-9]/`會找到`B`。

#### `\w`

符合**所有字母數字的字元**條件，效果同於`[A-Za-z0-9_]`。

例如`/\w/`在`apple`中符合`a`，在`$5.28,`中符合`5`，在`3D`中符合`3`。

#### `\W`

符合**所有非字母數字的字元**條件，效果同於`[^A-Za-z0-9_]`。

例如`/\w/`在`50%.`中符合`%`。

#### `\s`

符合**所有空白字元**的條件，空白字元包括space, tab, form feed, line feed，它的效果會同於`[ \f\n\r\t\v\u00a0\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]`。

例如對`foo bar.`使用`/\s\w*/`，`\s`會對應至空白字元，`\w*`會對應零到無限個字母字元，所以取得的結果會是`" bar"`。

#### `\S`

符合**所有非空白字元**的條件，空白字元包括space, tab, form feed, line feed，它的效果會同於`[^ \f\n\r\t\v\u00a0\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]`。

例如對`foo bar.`使用`/\S*/`，`\S`會對應至非空白字元，所以取得的結果會是`foo`。

### `\f`, `\n`, `\r`, `\t`, `\v`

這個系列為符合各個**控制字元**，`\f`符合form feed(`U+000C`)條件，`\n`符合line feed(`U+000A`)條件， `\r`符合carriage return(`U+000D`)條件，`\t`符合tab(`U+0009`)條件，`\v`符合vertical tab(`U+000B`)條件。

前面三個字元(form feed、line feed、carriage return)的差異請參考[這篇](https://stackoverflow.com/a/3098328)，vertical tab可以參考[這篇](https://stackoverflow.com/a/3380554)。

#### `\cX`

用`\cX`取得**控制字元**，`X`為`A`到`Z`的字母，分別代表`U+0001`到`U+001A`的26個控制字元。

例如`\cM`就是代表`U+000D`的`control+M`。

### 反斜線

接於反斜線(`/`)後的一般字元變為特殊字元，特殊字元變為一般字元。

#### 一般字元變為特殊字元

字元`b`原本是一般字元，用來找尋符合**小寫b**的內容, 但如果是`\b`的話就代表**字母邊界**，就是用來找尋所有用來切開字母的字元（例如空白, 符號...等）。

#### 特殊字元變為一般字元

原本`/a*/`會去找零到多個連續的`a`，但如果使用`/a\*/`的話就會找尋符合`a*`的字串。

反斜線本身也是特殊字元，如果要找尋反斜線請使用`\\`。