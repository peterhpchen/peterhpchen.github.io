---
layout: post
title: Hello SignalR
date: '2014-04-02T22:51:00.000-07:00'
author: Peter
tags:
- ASP.NET
- HTML
- C#
- SignalR
modified_time: '2014-04-03T17:24:43.508-07:00'
thumbnail: http://4.bp.blogspot.com/-qz1EqmH0jfg/UzxAykfEL_I/AAAAAAAAAGM/1MSOinihMvs/s72-c/WebSocekt%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A.bmp
blogger_id: tag:blogger.com,1999:blog-8081092262828660128.post-2698099705342662170
blogger_orig_url: https://limitlessping.blogspot.com/2014/04/hello-signalr.html
---

<div class="separator" style="clear: both; text-align: center;"></div>這次要介紹的是ASP.NET SignalR library，它可以讓我們很簡單的寫出Real-time的網頁程式，原本要使用web socket在那寫的老半天，又要考慮到跨平台所帶來的影響，而使用了SignalR就不需要再考慮這些了，因為它都可以幫你處理，詳細的原理可以參考【<a href="http://blogs.msdn.com/b/msdntaiwan/archive/2013/09/09/signalr-reimagine-web-development.aspx">SignalR 再次超越你對 Web 的想像 - 建立即時互動的 Web</a>】這篇，在這篇裡我會demo一個簡單的<b>即時通訊</b>網頁。<br /><h2>平台</h2><div><ul><li>.NET Framework 4.5</li><li>C#</li><li>SignalR 2.0</li><li>Visual Studio 2012</li><li>Windows 8</li></ul></div><h2>實作(借用<a href="http://www.asp.net/signalr/overview/signalr-20/getting-started-with-signalr-20/tutorial-getting-started-with-signalr-20">Tutorial: Getting Started with SignalR 2.0</a>的例子)</h2><h3>Step 1</h3><h4>開啟WebSocket通訊協定</h4><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-qz1EqmH0jfg/UzxAykfEL_I/AAAAAAAAAGM/1MSOinihMvs/s1600/WebSocekt%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A.bmp" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-qz1EqmH0jfg/UzxAykfEL_I/AAAAAAAAAGM/1MSOinihMvs/s1600/WebSocekt%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A.bmp" height="282" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">控制台&gt;程式集&gt;程式和功能&gt;開啟或關閉Windows功能&gt;Internet Information Service&gt;World Wide Web功能&gt;應用程式開發功能&gt;勾選【WebSocket通訊協定】</td></tr></tbody></table><h3>Step 2</h3><h4>新增ASP.NET空白Web應用程式</h4><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-cwfOR5RWhqw/UzxDV-amUpI/AAAAAAAAAGg/a-q2QfNjwEE/s1600/%E6%96%B0%E5%A2%9E%E5%B0%88%E6%A1%88.bmp" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" src="http://1.bp.blogspot.com/-cwfOR5RWhqw/UzxDV-amUpI/AAAAAAAAAGg/a-q2QfNjwEE/s1600/%E6%96%B0%E5%A2%9E%E5%B0%88%E6%A1%88.bmp" height="247" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">選取【.NET Framework 4.5】&gt;選取【ASP.Net空白Web應用程式】&gt;按下【確定】</td></tr></tbody></table><h3>Step 3</h3><h4>安裝SignelR</h4><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-E3g7LmwfJ1I/UzxEb2BR3xI/AAAAAAAAAGo/_uvGaAQV7Yo/s1600/%E5%AE%89%E8%A3%9DSignalR.bmp" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-E3g7LmwfJ1I/UzxEb2BR3xI/AAAAAAAAAGo/_uvGaAQV7Yo/s1600/%E5%AE%89%E8%A3%9DSignalR.bmp" height="61" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">開啟【套件管理器主控台】&gt;鍵入【install-package Microsoft.AspNet.SignalR】&gt;按【Enter】</td></tr></tbody></table><div><h3>Step 4</h3></div><h4>建立SignalR Hub 類別</h4><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-dgtkvLohcf4/UzyyTDmBQkI/AAAAAAAAAG4/beNXCPtcMjU/s1600/%E5%BB%BA%E7%AB%8BSignalR+Hub%E9%A1%9E%E5%88%A5.bmp" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-dgtkvLohcf4/UzyyTDmBQkI/AAAAAAAAAG4/beNXCPtcMjU/s1600/%E5%BB%BA%E7%AB%8BSignalR+Hub%E9%A1%9E%E5%88%A5.bmp" height="247" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">方案總管中在方案上按【滑鼠右鍵】&gt;【加入】&gt;【新增項目】&gt;【SignalR Hub 類別】&gt;【新增】</td></tr></tbody></table><br /><div>在這個類別中我們可以撰寫signalR要做的函式，先把下面的code覆蓋初始的code :&nbsp;</div><script src="https://gist.github.com/CodingCodeChen/9946802.js?file=ChatHub.cs"></script> <br /><div>這裡不是很懂吧，沒關係，之後的說明會詳細解說。<br /><h3>Step 5</h3></div><h4>建立OWIN Startup類別</h4><div>建立一個類別，將下列程式碼貼上 :&nbsp;</div><script src="https://gist.github.com/CodingCodeChen/9946802.js?file=Startup.cs"></script> <br /><div>OWIN為Open Web Interface for .NET的簡稱，簡單的來說就是可以把原本預設的server做變更，像是.NET通常都是使用IIS，使用了OWIN我們就可以任意的決定我們的server side要給誰處理，在SignalR中我們就要把後端交給SignalR Hub運作。</div><h3>Step 6</h3><h4>建立.html及.js</h4><div>Chat.html :<br /><script src="https://gist.github.com/CodingCodeChen/9946802.js?file=Chat.html"></script>main.js :</div><script src="https://gist.github.com/CodingCodeChen/9946802.js?file=main.js"></script> <br /><div><b>注意</b> :<b>&nbsp;</b>Chat.html中script的載入順序一定要先jQuery再SignalR再&lt;script src="signalr/hubs"&gt;&lt;/script&gt;，signalr/hubs這個資料夾只有再run time的時候才會動態產生，它是SignalR用在jQuery及server端溝通上的管理。<br /><h3>Step 7</h3><h4>將Chat.html設為起始頁</h4><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-dkiFs47Gx-k/UzzCugafXbI/AAAAAAAAAHI/SLTln6YJAZc/s1600/%E8%B5%B7%E5%A7%8B%E9%A0%81.bmp" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-dkiFs47Gx-k/UzzCugafXbI/AAAAAAAAAHI/SLTln6YJAZc/s1600/%E8%B5%B7%E5%A7%8B%E9%A0%81.bmp" height="220" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Chat.html按【右鍵】&gt;【設定為起始頁】</td></tr></tbody></table><div><br /></div><h2>Demo</h2></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-wN1f61qTViM/UzzDuljkBII/AAAAAAAAAHQ/PBy-H_pSjaU/s1600/name.bmp" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-wN1f61qTViM/UzzDuljkBII/AAAAAAAAAHQ/PBy-H_pSjaU/s1600/name.bmp" height="195" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">輸入名字</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-IRT4l9Jj0hY/UzzESAOjq-I/AAAAAAAAAHc/UnRxJVjYZTc/s1600/%25E5%25A4%259A%25E5%2580%258B.bmp" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-IRT4l9Jj0hY/UzzESAOjq-I/AAAAAAAAAHc/UnRxJVjYZTc/s1600/%25E5%25A4%259A%25E5%2580%258B.bmp" height="90" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">開啟多個Chat.html</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-VYqgTG0l6No/UzzEjQGQ_1I/AAAAAAAAAHk/CS4S9HJdsys/s1600/%25E8%25BC%25B8%25E5%2585%25A5%25E6%2596%2587%25E5%25AD%2597.bmp" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-VYqgTG0l6No/UzzEjQGQ_1I/AAAAAAAAAHk/CS4S9HJdsys/s1600/%25E8%25BC%25B8%25E5%2585%25A5%25E6%2596%2587%25E5%25AD%2597.bmp" height="105" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">開始聊天嘍</td></tr></tbody></table><h2>程式運作說明</h2><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-5R8dCmQ_HUE/UzzNdM6MtHI/AAAAAAAAAHw/UjD8FCWMeCQ/s1600/%E9%81%8B%E4%BD%9C%E8%AA%AA%E6%98%8E.bmp" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://1.bp.blogspot.com/-5R8dCmQ_HUE/UzzNdM6MtHI/AAAAAAAAAHw/UjD8FCWMeCQ/s1600/%E9%81%8B%E4%BD%9C%E8%AA%AA%E6%98%8E.bmp" height="163" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">利用chat.server.send(name, message);去叫ChatHub中的send method，然後ChatHub會用Clients.All.broadcastMessage(name, message);去叫用client中的broadcastMessage將資訊傳給client</td></tr></tbody></table><div><h2>參考資料</h2></div><a href="http://blogs.msdn.com/b/msdntaiwan/archive/2013/09/09/signalr-reimagine-web-development.aspx">SignalR 再次超越你對 Web 的想像 - 建立即時互動的 Web</a><br /><div><a href="http://www.asp.net/signalr/overview/signalr-20/getting-started-with-signalr-20/tutorial-getting-started-with-signalr-20"><span style="font-size: small;">Tutorial: Getting Started with SignalR 2.0</span></a></div>